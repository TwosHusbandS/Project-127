<Window x:Class="Project_127.ColorPicker"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:cefSharp="clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf"
      xmlns:local="clr-namespace:Project_127"
      mc:Ignorable="d" 
      Height="400" Width="240"
      WindowStyle="ToolWindow"
      ResizeMode="CanMinimize"
      Title="ColorPicker">

    <Grid Height="400" Width="240">
        <cefSharp:ChromiumWebBrowser 
            x:Name="browser" 
            HorizontalAlignment="Right" 
            VerticalAlignment="Bottom" 
            Width="240" Height="400" 
            Margin="0,0,0,0" 
            Address="data:text/html;base64,PGh0bWw+CiAgICA8aGVhZD4KICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgIGNhbnZhcyB7CiAgICAgICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCBibGFjazsKICAgICAgICAgICAgfQogICAgICAgICAgICBib2R5IHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMzEyMTg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgI2FscGhhc2xpZGUgewogICAgICAgICAgICAgICAgd2lkdGg6IDIwNHB4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxhYmVsIHsKICAgICAgICAgICAgICAgIHdpZHRoOiAyMnB4OwogICAgICAgICAgICAgICAgY29sb3I6ICNjY2NjY2M7CiAgICAgICAgICAgICAgICBmb250LWZhbWlseTogJ0NvbnNvbGFzJywgJ21vbm9zcGFjZSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW5wdXRbdHlwZT0nbnVtYmVyJ10gewogICAgICAgICAgICAgICAgd2lkdGg6IDQ0cHg7CiAgICAgICAgICAgIH0KICAgICAgICA8L3N0eWxlPgogICAgICAgIDxzY3JpcHQ+CiAgICAgICAgICAgIGxldCBodWViYXJpbWFnZTsKICAgICAgICAgICAgbGV0IHNsUWltYWdlOwogICAgICAgICAgICBsZXQgYWNGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICBsZXQgaHVlID0gMTgwOwogICAgICAgICAgICBsZXQgcGh1ZSA9IDA7CiAgICAgICAgICAgIC8vbGV0IHBhbHBoYSA9IDE7CiAgICAgICAgICAgIGxldCBhbHBoYSA9IDE7CiAgICAgICAgICAgIGxldCBzbHh5ID0gWzAsMF07CiAgICAgICAgICAgIGxldCBoc2xhID0gWzAsMCwwLDBdOwogICAgICAgICAgICBsZXQgbW91c2Vkb3duID0gZmFsc2U7CiAgICAgICAgICAgIGxldCBuZXdGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICBmdW5jdGlvbiBmcmFtZSgpIHsKICAgICAgICAgICAgICAgIGlmIChuZXdGcmFtZSl7CiAgICAgICAgICAgICAgICAgICAgdXBkYXRlQ2FudmFzKCk7CiAgICAgICAgICAgICAgICAgICAgbmV3RnJhbWUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvL2xldCBjb21tT2JqZWN0ID0gbnVsbDsKICAgICAgICAgICAgZnVuY3Rpb24gaHNsYTJyZ2JhKGgsIHMsIGwsIGEpewogICAgICAgICAgICAgICAgbGV0IHIsZyxiOwogICAgICAgICAgICAgICAgbGV0IGMgPSAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpICogczsKICAgICAgICAgICAgICAgIGxldCB4ID0gYyAqICgxIC0gTWF0aC5hYnMoKGggLyA2MCkgJSAyIC0gMSkpOwogICAgICAgICAgICAgICAgbGV0IG0gPSBsIC0gYy8yOwogICAgICAgICAgICAgICAgaWYgKDAgPD0gaCAmJiBoIDwgNjApIHsKICAgICAgICAgICAgICAgICAgICByID0gYzsgZyA9IHg7IGIgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICg2MCA8PSBoICYmIGggPCAxMjApIHsKICAgICAgICAgICAgICAgICAgICByID0geDsgZyA9IGM7IGIgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgxMjAgPD0gaCAmJiBoIDwgMTgwKSB7CiAgICAgICAgICAgICAgICAgICAgciA9IDA7IGcgPSBjOyBiID0geDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoMTgwIDw9IGggJiYgaCA8IDI0MCkgewogICAgICAgICAgICAgICAgICAgIHIgPSAwOyBnID0geDsgYiA9IGM7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKDI0MCA8PSBoICYmIGggPCAzMDApIHsKICAgICAgICAgICAgICAgICAgICByID0geDsgZyA9IDA7IGIgPSBjOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICgzMDAgPD0gaCAmJiBoIDwgMzYwKSB7CiAgICAgICAgICAgICAgICAgICAgciA9IGM7IGcgPSAwOyBiID0geDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHIgPSBNYXRoLnJvdW5kKChyICsgbSkgKiAyNTUpOwogICAgICAgICAgICAgICAgZyA9IE1hdGgucm91bmQoKGcgKyBtKSAqIDI1NSk7CiAgICAgICAgICAgICAgICBiID0gTWF0aC5yb3VuZCgoYiArIG0pICogMjU1KTsKICAgICAgICAgICAgICAgIHJldHVybiBbciwgZywgYiwgYV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmdiYTJoc2xhKCkgewogICAgICAgICAgICAgICAgbGV0IHIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUkMiKS52YWx1ZS8yNTU7CiAgICAgICAgICAgICAgICBsZXQgZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJHQyIpLnZhbHVlLzI1NTsKICAgICAgICAgICAgICAgIGxldCBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkJDIikudmFsdWUvMjU1OwogICAgICAgICAgICAgICAgLy9kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWxwaGFzbGlkZSIpLnZhbHVlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkFDIikudmFsdWU7CiAgICAgICAgICAgICAgICBhbHBoYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJBQyIpLnZhbHVlLzI1NTsKCiAgICAgICAgICAgIC8vIEZpbmQgZ3JlYXRlc3QgYW5kIHNtYWxsZXN0IGNoYW5uZWwgdmFsdWVzCiAgICAgICAgICAgICAgICBsZXQgY21pbiA9IE1hdGgubWluKHIsZyxiKTsKICAgICAgICAgICAgICAgIGxldCBjbWF4ID0gTWF0aC5tYXgocixnLGIpOwogICAgICAgICAgICAgICAgbGV0IGRlbHRhID0gY21heCAtIGNtaW47CiAgICAgICAgICAgICAgICBsZXQgaCA9IDAsIHMgPSAwLCBsID0gMDsKICAgICAgICAgICAgICAgIGlmIChkZWx0YSA9PSAwKXsKICAgICAgICAgICAgICAgICAgICBoID0gMDsgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNtYXggPT0gcil7CiAgICAgICAgICAgICAgICAgICAgaCA9ICgoZyAtIGIpIC8gZGVsdGEpICUgNjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY21heCA9PSBnKXsKICAgICAgICAgICAgICAgICAgICBoID0gKGIgLSByKSAvIGRlbHRhICsgMjsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaCA9IChyIC0gZykgLyBkZWx0YSArIDQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBoID0gaCAqIDYwOwogICAgICAgICAgICAgICAgaHVlID0gaDwwPyBoKzM2MCA6IGg7CgogICAgICAgICAgICAgICAgbCA9IChjbWF4ICsgY21pbikgLyAyOwoKICAgICAgICAgICAgICAgIHMgPSAoZGVsdGEgPT0gMCkgPyAwIDogZGVsdGEgLyAoMSAtIE1hdGguYWJzKDIgKiBsIC0gMSkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2x4eVswXSA9ICsocyAqIDEwMCkgKiAyOwogICAgICAgICAgICAgICAgc2x4eVsxXSA9IDIwMCAtIChsICogMTAwKSAqIDI7CiAgICAgICAgICAgICAgICBuZXdGcmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mKENlZlNoYXJwKSAhPSAidW5kZWZpbmVkIikgCiAgICAgICAgICAgICAgICAgICAgQ2VmU2hhcnAuUG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkoWzI1NSpyLCAyNTUqZywgMjU1KmIsIGFscGhhXSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUNhbnZhcygpewogICAgICAgICAgICAgICAgaWYgKHNseHlbMV0gPiAyMDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMV0gPSAyMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2x4eVsxXSA8IDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMV0gPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHNseHlbMF0gPiAyMDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMF0gPSAyMDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2x4eVswXSA8IDApewogICAgICAgICAgICAgICAgICAgIHNseHlbMF0gPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29sb3JzcXVhcmUiKTsKICAgICAgICAgICAgICAgIGxldCBoID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImh1ZXNlbCIpOwogICAgICAgICAgICAgICAgLy9hbHBoYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhbHBoYXNsaWRlIikudmFsdWUvMjU1OwogICAgICAgICAgICAgICAgbGV0IHNxY3R4ID0gYy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgbGV0IGhjdHggPSBoLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgICAgICBzcWN0eC5maWxsU3R5bGUgPSAiIzc3NyI7CiAgICAgICAgICAgICAgICBzcWN0eC5maWxsUmVjdCgwLCAwLCAyMDAsIDIwMCk7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwyMDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gLTEwOyBqPD0gMTA7IGorKyl7CiAgICAgICAgICAgICAgICAgICAgICAgIHNxY3R4LmZpbGxTdHlsZSA9ICIjY2JjYmNiIjsKICAgICAgICAgICAgICAgICAgICAgICAgc3FjdHguZmlsbFJlY3QoMTAqaSwgMTAqaS0yMCpqLCAxMCwgMTApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxldCBkZWx0YSA9IGh1ZSAtIHBodWU7CiAgICAgICAgICAgICAgICAvL3BodWUgPSBodWU7CiAgICAgICAgICAgICAgICBzcWN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICAgICAgc3FjdHguZmlsdGVyID0gYGh1ZS1yb3RhdGUoJHtkZWx0YX1kZWcpYDsKICAgICAgICAgICAgICAgIHNxY3R4LmRyYXdJbWFnZShzbFFpbWFnZSwwLDApOwogICAgICAgICAgICAgICAgc3FjdHguZmlsdGVyID0gIm5vbmUiOwogICAgICAgICAgICAgICAgc3FjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgc3FjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBzcWN0eC5zdHJva2VTdHlsZSA9ICIjMDAwIjsKICAgICAgICAgICAgICAgIHNxY3R4LmFyYyhzbHh5WzBdLCBzbHh5WzFdLCA0LCAwLCAyKk1hdGguUEkpOwogICAgICAgICAgICAgICAgc3FjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgaWYgKGFjRnJhbWUgfHwgTWF0aC5hYnMocGh1ZSAtIGh1ZSkgPiA2MCl7CiAgICAgICAgICAgICAgICAgICAgYWNGcmFtZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIC8vcGFscGhhID0gYWxwaGEKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGFjRnJhbWUpOwogICAgICAgICAgICAgICAgICAgIHBodWUgPSBodWU7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZjID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgICAgICAgICAgdmMud2lkdGggPSB2Yy5oZWlnaHQgPSAyMDA7CiAgICAgICAgICAgICAgICAgICAgbGV0IHZjcmN0eCA9IHZjLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gMjAwOyBpKyspewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgZ3JhZGllbnQgPSBzcWN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAyMDAtaSwgMjAwLCAyMDAtaSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLGBoc2woJHtodWV9LCAwJSwgJHtpLzJ9JSlgKTsKICAgICAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsYGhzbCgke2h1ZX0sIDEwMCUsICR7aS8yfSUpYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZjcmN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgICAgICAgICAgICAgdmNyY3R4LmZpbGxSZWN0KDAsIDIwMC1pLCAyMDAsIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzbFFpbWFnZS5zcmMgPSB2Yy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOwogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodXBkYXRlQ2FudmFzLCAxMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGhjdHguZHJhd0ltYWdlKGh1ZWJhcmltYWdlLDAsMCk7CiAgICAgICAgICAgICAgICBoY3R4LmZpbGxTdHlsZSA9ICcjMDAwJzsKICAgICAgICAgICAgICAgIGhjdHguZmlsbFJlY3QoMjAwKihodWUvMzYwKSwwLDEsMjApOwogICAgICAgICAgICAgICAgaHVlID0gaHVlPj0zNjA/MzU5Ljk5Omh1ZTsKICAgICAgICAgICAgICAgIGxldCByZ2JhID0gaHNsYTJyZ2JhKGh1ZSwgc2x4eVswXS8yMDAsICgyMDAtc2x4eVsxXSkvMjAwLCBhbHBoYSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUkNTIikudmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUkMiKS52YWx1ZSA9IHJnYmFbMF07CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiR0NTIikudmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiR0MiKS52YWx1ZSA9IHJnYmFbMV07CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQkNTIikudmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQkMiKS52YWx1ZSA9IHJnYmFbMl07CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQUNTIikudmFsdWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQUMiKS52YWx1ZSA9IE1hdGgucm91bmQocmdiYVszXSoyNTUpOwogICAgICAgICAgICAgICAgaWYgKHR5cGVvZihDZWZTaGFycCkgIT0gInVuZGVmaW5lZCIpIAogICAgICAgICAgICAgICAgICAgIENlZlNoYXJwLlBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KHJnYmEpKTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShyZ2JhKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q3Vyc29yUG9zaXRpb24oY2FudmFzLCBldmVudCkgezsKICAgICAgICAgICAgICAgIGNvbnN0IHJlY3QgPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkKICAgICAgICAgICAgICAgIGNvbnN0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0OwogICAgICAgICAgICAgICAgY29uc3QgeSA9IGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcDsKICAgICAgICAgICAgICAgIHJldHVybiBbeCx5XTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBjb25zdCBjc3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NvbG9yc3F1YXJlJyk7CiAgICAgICAgICAgICAgICBjc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIG1vdXNlZG93biA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgc2x4eSA9IGdldEN1cnNvclBvc2l0aW9uKGNzcXVhcmUsIGUpOwogICAgICAgICAgICAgICAgICAgIG5ld0ZyYW1lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY3NxdWFyZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKCkgPT4gbW91c2Vkb3duID0gZmFsc2UpOwogICAgICAgICAgICAgICAgY3NxdWFyZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobW91c2Vkb3duKXsKICAgICAgICAgICAgICAgICAgICAgICAgc2x4eSA9IGdldEN1cnNvclBvc2l0aW9uKGNzcXVhcmUsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBuZXdGcmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBjb25zdCBodWVzZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaHVlc2VsJyk7CiAgICAgICAgICAgICAgICBodWVzZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbW91c2Vkb3duID0gdHJ1ZTsgCiAgICAgICAgICAgICAgICAgICAgbGV0IHh5ID0gZ2V0Q3Vyc29yUG9zaXRpb24oaHVlc2VsLCBlKTsKICAgICAgICAgICAgICAgICAgICBodWUgPSAoeHlbMF0vMjAwKSozNjA7CiAgICAgICAgICAgICAgICAgICAgbmV3RnJhbWUgPSB0cnVlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBodWVzZWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsICgpID0+IG1vdXNlZG93biA9IGZhbHNlKTsKICAgICAgICAgICAgICAgIGh1ZXNlbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBlID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAobW91c2Vkb3duKXsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHh5ID0gZ2V0Q3Vyc29yUG9zaXRpb24oaHVlc2VsLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgaHVlID0gKHh5WzBdLzIwMCkqMzYwOwogICAgICAgICAgICAgICAgICAgICAgICBuZXdGcmFtZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBsZXQgc2xpZGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W3R5cGU9InJhbmdlIl0nKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2xpZGVycy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgICAgICAgICAgc2xpZGVyc1tpXS5zdHlsZS53aWR0aCA9IDE5OCAtIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9Im51bWJlciJdJykub2Zmc2V0V2lkdGggLSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdsYWJlbCcpLm9mZnNldFdpZHRoOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbGV0IGggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHVlc2VsIik7CiAgICAgICAgICAgICAgICBsZXQgaGN0eCA9IGguZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjAwOyBpKyspewogICAgICAgICAgICAgICAgICAgIGhjdHguZmlsbFN0eWxlID0gYGhzbCgkezM2MCooKGkrMSkvMjAwKX0sIDEwMCUsIDUwJSlgOwogICAgICAgICAgICAgICAgICAgIGhjdHguZmlsbFJlY3QoaSwwLDEsMjApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaHVlYmFyaW1hZ2UgPSBuZXcgSW1hZ2U7CiAgICAgICAgICAgICAgICBodWViYXJpbWFnZS5zcmMgPSBoLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIik7CgogICAgICAgICAgICAgICAgbGV0IGMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29sb3JzcXVhcmUiKTsKICAgICAgICAgICAgICAgIGxldCBzcWN0eCA9IGMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDIwMDsgaSsrKXsKICAgICAgICAgICAgICAgICAgICBsZXQgZ3JhZGllbnQgPSBzcWN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAyMDAtaSwgMjAwLCAyMDAtaSk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsYGhzbGEoMCwgMCUsICR7aS8yfSUpYCk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsYGhzbGEoMCwgMTAwJSwgJHtpLzJ9JSlgKTsKICAgICAgICAgICAgICAgICAgICBzcWN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgICAgICAgICBzcWN0eC5maWxsUmVjdCgwLCAyMDAtaSwgMjAwLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNsUWltYWdlID0gbmV3IEltYWdlOwogICAgICAgICAgICAgICAgc2xRaW1hZ2Uuc3JjID0gYy50b0RhdGFVUkwoImltYWdlL3BuZyIpOwoKICAgICAgICAgICAgICAgIG5ld0ZyYW1lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHNldEludGVydmFsKGZyYW1lLCAxMDAwLzMwKTsKICAgICAgICAgICAgICAgIHNldEludGVydmFsKCgpPT4ge25ld0ZyYW1lID0gKE1hdGguYWJzKHBodWUgLSBodWUpID4gMSk7IGFjRnJhbWUgPSB0cnVlfSwgNTAwKTsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCk9Pm5ld0ZyYW1lID0gdHJ1ZSwgNjAwKTsKICAgICAgICAgICAgfQogICAgICAgIDwvc2NyaXB0PgogICAgPC9oZWFkPgogICAgPGJvZHk+CiAgICAgICAgPGNhbnZhcyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgaWQ9ImNvbG9yc3F1YXJlIj48L2NhbnZhcz48YnI+PGJyPgogICAgICAgIDxjYW52YXMgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMCIgaWQ9Imh1ZXNlbCI+PC9jYW52YXM+PGJyPgogICAgICAgIDxsYWJlbD5SOiZuYnNwOzwvbGFiZWw+PGlucHV0IHR5cGU9InJhbmdlIiBpZD0iUkNTIiBtaW49IjAiIG1heD0iMjU1IiB2YWx1ZT0iMjU1IiBvbmlucHV0PSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnUkMnKS52YWx1ZSA9IHRoaXMudmFsdWU7cmdiYTJoc2xhKCk7bmV3RnJhbWUgPSB0cnVlOyIvPjxpbnB1dCB0eXBlPSJudW1iZXIiIHZhbHVlPSIyNTUiIG1pbj0wIG1heD0yNTUgaWQ9IlJDIiBjbGFzcz0iQ1YiIG9uY2hhbmdlPSJyZ2JhMmhzbGEoKSI+PGJyPgogICAgICAgIDxsYWJlbD5HOiZuYnNwOzwvbGFiZWw+PGlucHV0IHR5cGU9InJhbmdlIiBpZD0iR0NTIiBtaW49IjAiIG1heD0iMjU1IiB2YWx1ZT0iMjU1IiBvbmlucHV0PSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnR0MnKS52YWx1ZSA9IHRoaXMudmFsdWU7cmdiYTJoc2xhKCk7bmV3RnJhbWUgPSB0cnVlOyIvPjxpbnB1dCB0eXBlPSJudW1iZXIiIHZhbHVlPSIyNTUiIG1pbj0wIG1heD0yNTUgaWQ9IkdDIiBjbGFzcz0iQ1YiIG9uY2hhbmdlPSJyZ2JhMmhzbGEoKSI+PGJyPgogICAgICAgIDxsYWJlbD5COiZuYnNwOzwvbGFiZWw+PGlucHV0IHR5cGU9InJhbmdlIiBpZD0iQkNTIiBtaW49IjAiIG1heD0iMjU1IiB2YWx1ZT0iMjU1IiBvbmlucHV0PSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnQkMnKS52YWx1ZSA9IHRoaXMudmFsdWU7cmdiYTJoc2xhKCk7bmV3RnJhbWUgPSB0cnVlOyIvPjxpbnB1dCB0eXBlPSJudW1iZXIiIHZhbHVlPSIyNTUiIG1pbj0wIG1heD0yNTUgaWQ9IkJDIiBjbGFzcz0iQ1YiIG9uY2hhbmdlPSJyZ2JhMmhzbGEoKSI+PGJyPgogICAgICAgIDxsYWJlbD5BOiZuYnNwOzwvbGFiZWw+PGlucHV0IHR5cGU9InJhbmdlIiBpZD0iQUNTIiBtaW49IjAiIG1heD0iMjU1IiB2YWx1ZT0iMjU1IiBvbmlucHV0PSJkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnQUMnKS52YWx1ZSA9IHRoaXMudmFsdWU7cmdiYTJoc2xhKCk7bmV3RnJhbWUgPSB0cnVlOyIvPjxpbnB1dCB0eXBlPSJudW1iZXIiIHZhbHVlPSIyNTUiIG1pbj0wIG1heD0yNTUgaWQ9IkFDIiBjbGFzcz0iQ1YiIG9uY2hhbmdlPSJyZ2JhMmhzbGEoKSI+CgogICAgPC9ib2R5PiAgICAKPC9odG1sPg==" 
            JavascriptMessageReceived="browser_JavascriptMessageReceived"/>
    </Grid>
</Window>
